<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Rooms - LakeSide Hotel</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Page Header -->
        <div class="hero-section py-4">
            <div class="container">
                <h1 class="display-4 fw-bold">Our Rooms</h1>
                <p class="lead">Choose from our selection of luxurious accommodations</p>
            </div>
        </div>
        
        <div class="container py-5">
            <!-- Filter Section -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Filter Rooms</h5>
                    <form method="get" action="/rooms">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="roomType" class="form-label">Room Type</label>
                                <select class="form-select" id="roomType" name="roomType">
                                    <option value="">All Types</option>
                                    <option th:each="type : ${roomTypes}" 
                                            th:value="${type}" 
                                            th:text="${type}">Room Type</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="minPrice" class="form-label">Min Price</label>
                                <input type="number" class="form-control" id="minPrice" name="minPrice" placeholder="0">
                            </div>
                            <div class="col-md-3">
                                <label for="maxPrice" class="form-label">Max Price</label>
                                <input type="number" class="form-control" id="maxPrice" name="maxPrice" placeholder="1000">
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Rooms Grid -->
            <div class="row g-4" th:if="${rooms != null and !rooms.isEmpty()}">
                <div class="col-md-6 col-lg-4" th:each="room : ${rooms}">
                    <div class="card room-card h-100">
                        <img th:if="${room.photo != null}" 
                             th:src="@{'data:image/jpeg;base64,' + ${room.photo}}" 
                             class="card-img-top" 
                             style="height: 250px; object-fit: cover;"
                             alt="Room Photo">
                        <img th:unless="${room.photo != null}" 
                             src="https://via.placeholder.com/400x250?text=No+Image" 
                             class="card-img-top" 
                             style="height: 250px; object-fit: cover;"
                             alt="No Image">
                        <div class="card-body">
                            <h5 class="card-title" th:text="${room.roomType}">Room Type</h5>
                            <p class="card-text">
                                <i class="fas fa-tag text-primary"></i> 
                                <strong>Price:</strong> $<span th:text="${room.roomPrice}">0</span> per night
                            </p>
                            <p class="card-text">
                                <i class="fas fa-info-circle text-primary"></i>
                                <strong>Room ID:</strong> #<span th:text="${room.id}">0</span>
                            </p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="badge bg-success px-3 py-2" th:if="${room.isBooked == false}">
                                    <i class="fas fa-check-circle"></i> Available
                                </span>
                                <span class="badge bg-danger px-3 py-2" th:if="${room.isBooked == true}">
                                    <i class="fas fa-times-circle"></i> Booked
                                </span>
                                <div class="btn-group" role="group">
                                    <a th:href="@{/room/{id}(id=${room.id})}" 
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <a th:href="@{/booking/new/{id}(id=${room.id})}" 
                                       class="btn btn-sm btn-primary"
                                       th:classappend="${room.isBooked} ? 'disabled' : ''">
                                        <i class="fas fa-calendar-plus"></i> Book
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- No Rooms Message -->
            <div th:if="${rooms == null or rooms.isEmpty()}" class="text-center py-5">
                <i class="fas fa-bed fa-5x text-muted mb-3"></i>
                <h3>No Rooms Available</h3>
                <p class="text-muted">Please check back later or adjust your filters.</p>
            </div>
        </div>
    </div>
    
    <th:block layout:fragment="scripts">
        <script>
            // Preserve filter values after form submission
            const urlParams = new URLSearchParams(window.location.search);
            const roomType = urlParams.get('roomType');
            const minPrice = urlParams.get('minPrice');
            const maxPrice = urlParams.get('maxPrice');
            
            if (roomType) document.getElementById('roomType').value = roomType;
            if (minPrice) document.getElementById('minPrice').value = minPrice;
            if (maxPrice) document.getElementById('maxPrice').value = maxPrice;
        </script>
    </th:block>
</body>
</html>
